from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By

import pandas as pd
import time
from numpy import nan

service = Service("./chromedriver")
driver = webdriver.Chrome(service=service)


# id_list = ["957645", "253802", "927119", "1294030", "1283437"]

id_list = ["26946",
           "337913",
           "29702",
           "6938",
           "389605",
           "1151270",
           "26184",
           "274926",
           "44936",
           "227712",
           "1175485",
           "56283",
           "1070183",
           "6553",
           "4498",
           "5390",
           "27783",
           "27639",
           "53910",
           "527299",
           "47569",
           "8119",
           "574178",
           "249866",
           "16932",
           "49764",
           "500360",
           "276298",
           "12856",
           "450860",
           "26490",
           "324444",
           "5334",
           "500268",
           "459508",
           "1176959",
           "600498",
           "30176",
           "371150",
           "1254269",
           "778963",
           "31730",
           "31107",
           "310958",
           "32091",
           "277916",
           "302582",
           "228430",
           "31820",
           "220435",
           "26252",
           "422992",
           "1083128",
           "851261",
           "481979",
           "1123073",
           "376324",
           "236694",
           "31750",
           "333904",
           "327123",
           "554691",
           "1125976",
           "26789",
           "670031",
           "591650",
           "230593",
           "1079839",
           "36110",
           "7702",
           "326434",
           "1081183",
           "33141",
           "430401",
           "35586",
           "694211",
           "379504",
           "39024",
           "433410",
           "26206",
           "732291",
           "311158",
           "268739",
           "37737",
           "430125",
           "537126",
           "27685",
           "230371",
           "379927",
           "477069",
           "35928",
           "5560",
           "5674",
           "7547",
           "326016",
           "315623",
           "6278",
           "49700",
           "388678",
           "1151288",
           "533042",
           "253798",
           "45705",
           "326637",
           "32540",
           "55395",
           "51880",
           "439952",
           "277662",
           "5236",
           "288992",
           "6903",
           "209457",
           "45963",
           "8291",
           "31104",
           "302208",
           "232359",
           "32093",
           "457249",
           "48835",
           "247235",
           "1131754",
           "1108375",
           "362541",
           "321777",
           "219889",
           "328163",
           "237701",
           "1070665",
           "44938",
           "4508",
           "36071",
           "51439",
           "53115",
           "5583",
           "497121",
           "5766",
           "45782",
           "236489",
           "381743",
           "308798",
           "528985",
           "8002",
           "308251",
           "30719",
           "447261",
           "38710",
           "277472",
           "51050",
           "1119026",
           "379140",
           "49289",
           "6981",
           "327830",
           "272949",
           "6513",
           "826901",
           "590327",
           "20236",
           "53118",
           "278482",
           "277955",
           "6285",
           "4864",
           "32389",
           "221140",
           "47492",
           "24598",
           "431901",
           "340841",
           "670013",
           "974175",
           "44410",
           "44828",
           "51782",
           "28671",
           "5681",
           "47270",
           "375126",
           "6565",
           "823509",
           "28763",
           "643433",
           "452044",
           "4451",
           "325026",
           "17991",
           "537124",
           "29264",
           "391128",
           "422847",
           "1168641",
           "340854",
           "1312645",
           "236810",
           "337790",
           "244639",
           "45224",
           "625371",
           "436757",
           "43906",
           "1175423",
           "390481",
           "447439",
           "32685",
           "31088",
           "40618",
           "277237",
           "279554",
           "720471",
           "236779",
           "559066",
           "328026",
           "46248",
           "774223",
           "26291",
           "376102",
           "44149",
           "669855",
           "308967",
           "38062",
           "38373",
           "355269",
           "390484",
           "37004",
           "53191",
           "45789",
           "625383",
           "298438",
           "47693",
           "12454",
           "272465",
           "297433",
           "45797",
           "721867",
           "29976",
           "391485",
           "44932",
           "270484",
           "230554",
           "288284",
           "5702",
           "1124282",
           "527663",
           "35261",
           "223642",
           "447587",
           "625960",
           "230553",
           "41028",
           "391121",
           "319750",
           "230559",
           "322535",
           "1122918",
           "319745",
           "777537",
           "50710",
           "30045",
           "28997",
           "424377",
           "471342",
           "297583",
           "942645",
           "1159843",
           "371814",
           "398439",
           "1070188",
           "422108",
           "677081",
           "49535",
           "290716",
           "269170",
           "19296",
           "550215",
           "1163695",
           "529436",
           "1246518",
           "277906",
           "559235",
           "431876",
           "30288",
           "272262",
           "1206495",
           "26236",
           "4541",
           "930189",
           "232284",
           "26829",
           "19264",
           "493773",
           "23460",
           "53116",
           "50431",
           "7502",
           "38699",
           "34019",
           "403902",
           "398438",
           "30220",
           "398506",
           "56007",
           "528067",
           "311592",
           "351588",
           "5961",
           "390480",
           "393279",
           "300631",
           "31028",
           "5939",
           "49638",
           "6033",
           "41378",
           "696401",
           "4578",
           "226492",
           "16406",
           "319439",
           "502714",
           "29990",
           "30049",
           "6161",
           "853265",
           "290630",
           "35565",
           "5616",
           "8917",
           "31001",
           "1081442",
           "46538",
           "18458",
           "32965",
           "537119",
           "49636",
           "52983",
           "46592",
           "47711",
           "55988",
           "41411",
           "516824",
           "41434",
           "25913",
           "481896",
           "940973",
           "917159",
           "325012",
           "33440",
           "272450",
           "27280",
           "28081",
           "317293",
           "719719",
           "230193",
           "1138316",
           "974109",
           "1125688",
           "330902",
           "44111",
           "237095",
           "532856",
           "12440",
           "1048813",
           "333780",
           "7443",
           "37749",
           "233514",
           "261354",
           "604302",
           "604527",
           "274785",
           "554700",
           "826915",
           "32102",
           "20123",
           "906783",
           "820691",
           "32973",
           "32242",
           "376109",
           "378496",
           "323131",
           "342619",
           "500135",
           "35630",
           "10772",
           "28160",
           "777515",
           "489889",
           "279545",
           "1070180",
           "30732",
           "327127",
           "530773",
           "956871",
           "279562",
           "32966",
           "32130",
           "1070168",
           "1159712",
           "34282",
           "34155",
           "1161024",
           "334337",
           "552152",
           "587152",
           "784379",
           "379143",
           "1292502",
           "234675",
           "1079470",
           "270117",
           "793463",
           "1161020",
           "42421",
           "26421",
           "1161489",
           "446763",
           "1175441",
           "26907",
           "236766",
           "1064812",
           "1060380",
           "290727",
           "28114",
           "46148",
           "47850",
           "424219",
           "34102",
           "5779",
           "46750",
           "211854",
           "642531",
           "723105",
           "46393",
           "823703",
           "353669",
           "47660",
           "1079434",
           "961713",
           "820351",
           "35280",
           "52912",
           "27150",
           "931581",
           "32391",
           "290713",
           "318845",
           "52969",
           "1048841",
           "33870",
           "10582",
           "28792",
           "627385",
           "272994",
           "677077",
           "390547",
           "34078",
           "423838",
           "7133",
           "28846",
           "35731",
           "1201520",
           "35582",
           "398666",
           "26782",
           "432783",
           "42683",
           "438362",
           "26798",
           "290632",
           "446507",
           "51433",
           "26806",
           "27225",
           "29655",
           "29725",
           "38407",
           "279552",
           "28779",
           "51469",
           "337916",
           "28235",
           "422342",
           "714451",
           "36326",
           "6683",
           "914541",
           "344580",
           "1159711",
           "42639",
           "56143",
           "377534",
           "1079848",
           "717201",
           "317709",
           "42655",
           "42657",
           "1070173",
           "1159722",
           "34245",
           "326017",
           "917213",
           "33335",
           "35353",
           "8166",
           "317292",
           "960361",
           "49758",
           "662973",
           "5605",
           "6128",
           "46774",
           "273439",
           "31872",
           "32084",
           "642525",
           "475281",
           "43265",
           "670025",
           "267192",
           "37000",
           "302579",
           "237696",
           "230558",
           "556537",
           "33757",
           "50438",
           "35320",
           "8180",
           "495551",
           "642519",
           "228943",
           "1083851",
           "34274",
           "34118",
           "377437",
           "35390",
           "49209",
           "27223",
           "317784",
           "271315",
           "35282",
           "35619",
           "425943",
           "232292",
           "297628",
           "8076",
           "277912",
           "877051",
           "7252",
           "232364",
           "892749",
           "45434",
           "1170265",
           "550235",
           "331855",
           "625964",
           "34281",
           "48472",
           "530011",
           "35401",
           "802575",
           "4292",
           "379145",
           "459257",
           "595978",
           "55805",
           "49677",
           "822553",
           "262533",
           "446499",
           "30235",
           "43524",
           "1246528",
           "215155",
           "376116",
           "1209292",
           "554699",
           "720465",
           "732293",
           "253802",
           "528967",
           "360911",
           "851403",
           "35281",
           "35263",
           "477021",
           "31738",
           "307448",
           "30750",
           "31732",
           "31041",
           "719715",
           "265564",
           "29646",
           "279810",
           "50804",
           "319744",
           "224367",
           "1159720",
           "36130",
           "1151278",
           "28830",
           "32498",
           "317786",
           "43652",
           "1121579",
           "430246",
           "36084",
           "35805",
           "35357",
           "30102"]

current_ids = pd.read_csv("./test_df.csv")['id']

df_cols = ['id', 'full_name', 'born', 'age', "nicknames",
           'batting_style', 'bowling_style', 'playing_role', "height"]

player_df = pd.DataFrame(columns=df_cols)

unidentified_links = []

for id in id_list:
    if id in list(current_ids):
        continue
    
    driver = webdriver.Chrome(service=service)
    info_list = {'id': id, "full_name": nan, "born": nan, 'age': nan, 'nicknames': nan, 'fielding_position': nan,
                 'batting_style': nan, 'bowling_style': nan, 'playing_role': nan, 'height': nan}
    baseurl = f'https://duckduckgo.com/?q={id}+espncricinfo&t=h_&ia=web'
    driver.get(baseurl)

    links_container = driver.find_element(by=By.ID, value="links")
    espn_links = links_container.find_element(
        by=By.PARTIAL_LINK_TEXT, value="https://www.espncricinfo.com")

    formatted_link = espn_links.text.replace(" › ", "/")
    if formatted_link[-len(id):] != id:
        unidentified_links.append(id)
        continue

    time.sleep(2)
    driver.get(formatted_link)
    time.sleep(2)

    player_grid = driver.find_element(
        By.CSS_SELECTOR, "div.ds-gap-4.ds-mb-8")
    info_col = player_grid.find_elements(By.CSS_SELECTOR, "div p")
    player_info = player_grid.find_elements(
        by=By.CSS_SELECTOR, value="span h5")

    for index, meta in enumerate(player_info):
        info_list[info_col[index].text.replace(" ", "_").lower()] = meta.text
        print(meta.text)
    player_df = player_df.append(info_list, ignore_index=True)
    print("-"*20)
    player_df.to_csv('test_df.csv', index=False)
    time.sleep(2)
    driver.quit()



player_df.to_csv('test_df.csv', index=False)
print("-"*20)
print(unidentified_links)